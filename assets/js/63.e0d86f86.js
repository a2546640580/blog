(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{532:function(s,t,e){"use strict";e.r(t);var r=e(0),n=Object(r.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"kl文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kl文件"}},[s._v("#")]),s._v(" kl文件")]),s._v(" "),t("p",[t("strong",[s._v("kl")]),s._v("（"),t("strong",[s._v("key layout")]),s._v("）文件是一个映射文件，是"),t("strong",[s._v("标准linux")]),s._v("与"),t("strong",[s._v("anroid键值")]),s._v("映射文件，"),t("strong",[s._v("kl文件")]),s._v("可以有很多个，但是它有一个使用优先级：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/system/usr/keylayout/Vendor_XXXX_Product_XXXX_Version_XXXX.kl  \n/system/usr/keylayout/Vendor_XXXX_Product_XXXX.kl  \n/system/usr/keylayout/DEVICE_NAME.kl  \n/data/system/devices/keylayout/Vendor_XXXX_Product_XXXX_Version_XXXX.kl  \n/data/system/devices/keylayout/Vendor_XXXX_Product_XXXX.kl  \n/data/system/devices/keylayout/DEVICE_NAME.kl  \n/system/usr/keylayout/Generic.kl  \n/data/system/devices/keylayout/Generic.kl \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[t("strong",[s._v("vendor id")]),s._v("和"),t("strong",[s._v("product id")]),s._v("。根据这两个"),t("strong",[s._v("id")]),s._v("创建对应名称的"),t("strong",[s._v("kl")]),s._v("文件，然后传入设备的对应目录，重启即可看到效果。")]),s._v(" "),t("p",[s._v("一般来说kl文件由厂家提供，但是有一些无良厂家不想修改，如果键值不冲突，可以直接在Generic.kl文件中更改")]),s._v(" "),t("p",[s._v("Generic.kl文件在代码中的位置为")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("./framewprk/base/data/keyboards/Generic.kl\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"kl文件命名含义"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kl文件命名含义"}},[s._v("#")]),s._v(" kl文件命名含义")]),s._v(" "),t("p",[s._v("kl文件在源码内的目录："),t("strong",[s._v("\\RTD2853R\\kernel\\android\\R\\frameworks\\base\\data\\keyboards")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/shug666/image/images/4273129-2d321ecfed4b958d.png",alt:"img"}})]),s._v(" "),t("p",[s._v("目录下的"),t("strong",[s._v("kl文件")]),s._v("非常多，这里以"),t("strong",[s._v("Vendor_0b05_Product_4500.kl")]),s._v("为例：")]),s._v(" "),t("p",[t("strong",[s._v("Vendor_0b05")]),s._v(" ：表示生产商代码是"),t("strong",[s._v("0b05")])]),s._v(" "),t("p",[t("strong",[s._v("Product_4500")]),s._v(" ：表示产品型号为"),t("strong",[s._v("4500")])]),s._v(" "),t("p",[s._v("之后再跟输入设备的对应"),t("strong",[s._v("id")]),s._v("进行匹配，就可以知道该"),t("strong",[s._v("kl文件")]),s._v("所对应的设备。")]),s._v(" "),t("h3",{attrs:{id:"获得输入设备和按键信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获得输入设备和按键信息"}},[s._v("#")]),s._v(" 获得输入设备和按键信息")]),s._v(" "),t("p",[s._v("实际开发中我们可以通过"),t("strong",[s._v("getevent")]),s._v("获取到输入设备的"),t("strong",[s._v("vendor id")]),s._v("，"),t("strong",[s._v("product id")]),s._v("和"),t("strong",[s._v("按键事件值")]),s._v("\n通过串口连接后输入"),t("strong",[s._v("getevent")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/shug666/image/images/image-20220820113829296.png",alt:"image-20220820113829296"}})]),s._v(" "),t("p",[s._v("以上的输出分为两个部分，上半部分代表当前设备上的输入设备，下面是点击按键后产生的输出。")]),s._v(" "),t("p",[s._v("可以看到遥控器按键对应的输入设备节点为 "),t("strong",[s._v("/dev/input/event0")]),s._v(" 。")]),s._v(" "),t("p",[s._v("之后通过"),t("strong",[s._v("getevent -i /dev/input/event0")]),s._v("查看该设备的"),t("strong",[s._v("vendor id")]),s._v("和"),t("strong",[s._v("product id")]),s._v("。输出结果如下：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/shug666/image/images/4273129-ce87a37852c5c5d6.png",alt:"img"}})]),s._v(" "),t("p",[s._v("此时我们就可以根据对应的"),t("strong",[s._v("vendor id")]),s._v("和"),t("strong",[s._v("product id")]),s._v("创建自己的"),t("strong",[s._v("kl文件")]),s._v("，然后传入设备中验证，首先去源码对应的目录中找到对应的"),t("strong",[s._v("kl文件")]),s._v("来增加按键映射，即"),t("strong",[s._v("Vendor_0416_Product_038f.kl")]),s._v("文件，如果没有该文件，那么证明系统针对该设备的按键做特殊处理，之后就会根据上述所说的使用优先级去加载其他的"),t("strong",[s._v("kl文件")]),s._v("。这里我们新建一个"),t("strong",[s._v("Vendor_0416_Product_038f.kl")]),s._v("文件。然后根据分析的按键信息来往里面添加内容。")]),s._v(" "),t("h3",{attrs:{id:"按键信息分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#按键信息分析"}},[s._v("#")]),s._v(" 按键信息分析")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/shug666/image/images/image-20220820133509389.png",alt:"image-20220820133509389"}})]),s._v(" "),t("p",[s._v("我们每次按键会有四个输出，前两行为"),t("strong",[s._v("按下")]),s._v("，后两行为"),t("strong",[s._v("抬起")]),s._v("，"),t("strong",[s._v("0001")]),s._v("指按键（也存在其他设备类型，这里我们不关心）")]),s._v(" "),t("p",[t("strong",[s._v("0066")]),s._v("是对应的"),t("strong",[s._v("十六进制按键值")]),s._v("，这里就是"),t("strong",[s._v("驱动")]),s._v("所设置的"),t("strong",[s._v("按键值")]),s._v("，可以去找驱动提供头文件查看该值所对应的"),t("strong",[s._v("按键名称")]),s._v("。")]),s._v(" "),t("p",[s._v("末尾的部分，"),t("strong",[s._v("00000001")]),s._v("为按下，"),t("strong",[s._v("00000000")]),s._v("为抬起。")]),s._v(" "),t("p",[s._v("在驱动提供的按键值input-event-codes.h头文件中，在文件内对应按键如下:")]),s._v(" "),t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[t("span",{pre:!0,attrs:{class:"token macro property"}},[t("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),t("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("define")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token macro-name"}},[s._v("KEY_TESTCODE")]),s._v("                    "),t("span",{pre:!0,attrs:{class:"token expression"}},[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x360")])])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("然后在我们默认的"),t("strong",[s._v("kl文件")]),s._v("，即"),t("strong",[s._v("venus_IR_input.kl")]),s._v("中找到"),t("strong",[s._v("0x360对应的10进制")]),s._v("对应"),t("strong",[s._v("Android")]),s._v("中的按键值如下：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("key 864     TESTCODE\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("这里即将"),t("strong",[s._v("驱动")]),s._v("上报的"),t("strong",[s._v("KEY_TESTCODE")]),s._v("转成了"),t("strong",[s._v("Android")]),s._v("的"),t("strong",[s._v("TESTCODE")]),s._v("按键，"),t("strong",[s._v("Android")]),s._v("对应的"),t("strong",[s._v("按键值列表头文件")]),s._v("目录为：\n"),t("strong",[s._v("/frameworks/native/include/android/keycodes.h")]),s._v("，如果我们要修改"),t("strong",[s._v("驱动层")]),s._v("上报的按键在"),t("strong",[s._v("Android")]),s._v("所对应的按键值，那么就可以在该头文件查找对应的按键，然后在"),t("strong",[s._v("kl文件")]),s._v("进行配置。")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.jianshu.com/p/1b0ae800b5bf",target:"_blank",rel:"noopener noreferrer"}},[s._v("可参考Android 按键映射kl文件编写简析"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("shugan6766@gmail.com")]),s._v(" "),t("h2",{attrs:{id:"android调试常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#android调试常用命令"}},[s._v("#")]),s._v(" Android调试常用命令")]),s._v(" "),t("h3",{attrs:{id:"input-命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#input-命令"}},[s._v("#")]),s._v(" input 命令")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("input keyevent KEYCODE_TESTCODE(或403)：可以向系统发送按键事件\n\ninput text<String>：可以接收字符串的UI 控件输入字符\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"dumpsys命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dumpsys命令"}},[s._v("#")]),s._v(" dumpsys命令")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("dumpsys input：可以查看输入设备情况,这个命令可以查看到输入设备映射到了哪一个kl文件\n\nKeyLayoutFile: /vendor/usr/keylayout/venus_IR_input.kl\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"getevent命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#getevent命令"}},[s._v("#")]),s._v(" getevent命令")]),s._v(" "),t("p",[s._v("查看输入设备/dev/input/event*是否有数据输入，查看键值，常用来调试遥控器")])])}),[],!1,null,null,null);t.default=n.exports}}]);