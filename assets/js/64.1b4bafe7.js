(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{513:function(a,n,e){"use strict";e.r(n);var s=e(0),t=Object(s.a)({},(function(){var a=this,n=a._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[n("p",[a._v("Android是多任务系统，Audio系统是竞争资源。Android2.2之前，没有内建的机制来解决多个程序竞争Audio的问题，2.2引入了称作AudioFocus的机制来管理对Audio资源的竞争的管理与协调。")]),a._v(" "),n("p",[n("strong",[a._v("按照AudioFocus的机制，在使用AudioStream之前，需要申请AudioFocus，在获得AudioFocus之后才可以使用相应的AudioStream；如果有别的程序竞争你正在使用的AudioStream，你的程序需要在收到通知之后做停止播放或者降低声音的处理。值得指出的是，这种机制是需要合作完成的，需要所有使用Audio资源的程序都按照这种机制来做，而如果有程序在它失去AudioFocus的时候仍然在使用Audio，AudioFocus拿它也没办法。而这一点对于开放系统的Android来说很致命的：用户可能安装没遵守这种机制的程序，或者版本太老还没引入这种机制的程序，这最终会导致很差的用户体验。")])]),a._v(" "),n("h2",{attrs:{id:"_1、audiofocus的申请与释放"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1、audiofocus的申请与释放"}},[a._v("#")]),a._v(" 1、AudioFocus的申请与释放")]),a._v(" "),n("p",[a._v("​       获取/放弃AudioFocus的方法都在android.media.AudioManager中，获取AudioFocus用requestAudioFocus()；用完之后，放弃AudioFocus，用abandonAudioFocus()。")]),a._v(" "),n("p",[a._v("其中，参数：")]),a._v(" "),n("ul",[n("li",[n("p",[a._v("**streamType：**播放流类型；")])]),a._v(" "),n("li",[n("p",[a._v("durationHint：")]),a._v(" "),n("p",[a._v("是持续性的指示：")]),a._v(" "),n("ul",[n("li",[n("code",[a._v("AUDIOFOCUS_GAIN")]),a._v(" 指示申请得到的Audio Focus不知道会持续多久，一般是长期占有；")]),a._v(" "),n("li",[n("code",[a._v("AUDIOFOCUS_GAIN_TRANSIENT")]),a._v("指示要申请的AudioFocus是暂时性的，会很快用完释放的；")]),a._v(" "),n("li",[n("a",{attrs:{href:"http://developer.android.com/reference/android/media/AudioManager.html#AUDIOFOCUS_GAIN_TRANSIENT_MAY_DUCK",target:"_blank",rel:"noopener noreferrer"}},[a._v("AUDIOFOCUS_GAIN_TRANSIENT_MAY_DUCK"),n("OutboundLink")],1),a._v(" 不但说要申请的AudioFocus是暂时性的，还指示当前正在使用AudioFocus的可以继续播放，只是要“duck”一下（降低音量）。")])])]),a._v(" "),n("li",[n("p",[n("strong",[n("a",{attrs:{href:"http://developer.android.com/reference/android/media/AudioManager.OnAudioFocusChangeListener.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("AudioManager.OnAudioFocusChangeListener"),n("OutboundLink")],1)]),a._v(" 是申请成功之后监听AudioFocus使用情况的Listener，后续如果有别的程序要竞争AudioFocus，都是通过这个Listener的"),n("a",{attrs:{href:"http://developer.android.com/reference/android/media/AudioManager.OnAudioFocusChangeListener.html#onAudioFocusChange(int)",target:"_blank",rel:"noopener noreferrer"}},[a._v("onAudioFocusChange()"),n("OutboundLink")],1),a._v("方法来通知这个Audio Focus的使用者的。")])])]),a._v(" "),n("p",[a._v("​    返回值，可能是：")]),a._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://developer.android.com/reference/android/media/AudioManager.html#AUDIOFOCUS_REQUEST_GRANTED",target:"_blank",rel:"noopener noreferrer"}},[a._v("AUDIOFOCUS_REQUEST_GRANTED"),n("OutboundLink")],1),a._v("：申请成功；")]),a._v(" "),n("li",[n("a",{attrs:{href:"http://developer.android.com/reference/android/media/AudioManager.html#AUDIOFOCUS_REQUEST_FAILED",target:"_blank",rel:"noopener noreferrer"}},[a._v("AUDIOFOCUS_REQUEST_FAILED"),n("OutboundLink")],1),a._v("：申请失败。")])]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("AudioManager audioManager = (AudioManager) context.getSystemService(Context.AUDIO_SERVICE);\naudioManager.requestAudioFocus(onAudioFocusChangeListener, AudioManager.STREAM_MUSIC, AudioManager.AUDIOFOCUS_GAIN);\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br")])]),n("h2",{attrs:{id:"_2、audiofocus被抢占与重新获得"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2、audiofocus被抢占与重新获得"}},[a._v("#")]),a._v(" 2、AudioFocus被抢占与重新获得")]),a._v(" "),n("p",[a._v("​    由上节中知道，申请/释放AudioFocus时传入了**"),n("a",{attrs:{href:"http://developer.android.com/reference/android/media/AudioManager.OnAudioFocusChangeListener.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("AudioManager.OnAudioFocusChangeListener"),n("OutboundLink")],1),a._v("**这个参数，其"),n("a",{attrs:{href:"http://developer.android.com/reference/android/media/AudioManager.OnAudioFocusChangeListener.html#onAudioFocusChange(int)",target:"_blank",rel:"noopener noreferrer"}},[a._v("onAudioFocusChange()"),n("OutboundLink")],1),a._v("方法是Audio Focus被抢占与再次获得通知的地方。所以，每个要使用AudioFocus的程序都要小心实现这个函数，保证AudioFocus实现的一致性。")]),a._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://developer.android.com/reference/android/media/AudioManager.html#AUDIOFOCUS_LOSS",target:"_blank",rel:"noopener noreferrer"}},[a._v("AUDIOFOCUS_LOSS"),n("OutboundLink")],1),a._v("：失去了Audio Focus，并将会持续很长的时间。这里因为可能会停掉很长时间，所以不仅仅要停止Audio的播放，最好直接释放掉Media资源。而因为停止播放Audio的时间会很长，如果程序因为这个原因而失去AudioFocus，最好不要让它再次自动获得AudioFocus而继续播放，不然突然冒出来的声音会让用户感觉莫名其妙，感受很不好。这里直接放弃AudioFocus，当然也不用再侦听远程播放控制【如下面代码的处理】。要再次播放，除非用户再在界面上点击开始播放，才重新初始化Media，进行播放。")]),a._v(" "),n("li",[n("a",{attrs:{href:"http://developer.android.com/reference/android/media/AudioManager.html#AUDIOFOCUS_LOSS_TRANSIENT",target:"_blank",rel:"noopener noreferrer"}},[a._v("AUDIOFOCUS_LOSS_TRANSIENT"),n("OutboundLink")],1),a._v("：暂时失去Audio Focus，并会很快再次获得。必须停止Audio的播放，但是因为可能会很快再次获得AudioFocus，这里可以不释放Media资源；")]),a._v(" "),n("li",[n("code",[a._v("AUDIOFOCUS_LOSS_TRANSIENT_CAN_DUCK")]),a._v("：暂时失去AudioFocus，但是可以继续播放，不过要在降低音量。")])]),a._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n     * 音频焦点监听\n     */")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AudioManager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("OnAudioFocusChangeListener")]),a._v(" onAudioFocusChangeListener "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AudioManager"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("OnAudioFocusChangeListener")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Override")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("onAudioFocusChange")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" focusChange"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("  \n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("focusChange "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AudioManager")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("AUDIOFOCUS_LOSS_TRANSIENT  \n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Pause playback   ")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("focusChange "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AudioManager")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("AUDIOFOCUS_LOSS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("  \n            am"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("unregisterMediaButtonEventReceiver")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("RemoteControlReceiver")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("  \n            am"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("abandonAudioFocus")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("afChangeListener"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("  \n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Stop playback   ")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("focusChange "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" AUDIOFOCUS_LOSS_TRANSIENT_CAN_DUCK"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("  \n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Lower the volume   ")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("focusChange "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AudioManager")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("AUDIOFOCUS_GAIN"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("  \n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Resume playback or Raise it back to normal   ")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("  \n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br"),n("span",{staticClass:"line-number"},[a._v("11")]),n("br"),n("span",{staticClass:"line-number"},[a._v("12")]),n("br"),n("span",{staticClass:"line-number"},[a._v("13")]),n("br"),n("span",{staticClass:"line-number"},[a._v("14")]),n("br"),n("span",{staticClass:"line-number"},[a._v("15")]),n("br"),n("span",{staticClass:"line-number"},[a._v("16")]),n("br"),n("span",{staticClass:"line-number"},[a._v("17")]),n("br"),n("span",{staticClass:"line-number"},[a._v("18")]),n("br"),n("span",{staticClass:"line-number"},[a._v("19")]),n("br")])]),n("h2",{attrs:{id:"参考连接官方api文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考连接官方api文档"}},[a._v("#")]),a._v(" 参考连接官方api文档")]),a._v(" "),n("p",[n("strong",[a._v("AudioManager文档中文翻译：https://www.itdaan.com/blog/2011/08/07/1674a0bd9fd7d2d4851cce0a77a3dfbe.html")])])])}),[],!1,null,null,null);n.default=t.exports}}]);