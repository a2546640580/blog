(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{516:function(s,a,t){"use strict";t.r(a);var n=t(0),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"内核-驱动层"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#内核-驱动层"}},[s._v("#")]),s._v(" 内核&驱动层")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("添加头文件：")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("<linux/kprobes.h>")]),s._v("  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("<asm/traps.h>")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("添加打印函数：")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("printk")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Stack trace Begin:\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dump_stack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("printk")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Stack trace End:\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])])]),s._v(" "),a("h2",{attrs:{id:"c-c-hal层"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#c-c-hal层"}},[s._v("#")]),s._v(" C&C++&HAL层")]),s._v(" "),a("p",[s._v("Android-Hal-C++打印调用栈")]),s._v(" "),a("p",[s._v("debuggerd是android的一个daemon进程，负责在进程出错异常时，将进程的运行时信息给dump出来供分析。\ndebuggerd的core dump数据，被保存在 /data/tombstone/ 目录下，共可保存10个文件，当超过10个时，会覆盖最早生产的文件。\n在debug时，一般情况下，当程序出现异常时会自动将core dump信息保存起来。")]),s._v(" "),a("p",[s._v("当需要手动调试自己的程序并需要主动打印调用栈时，可以使用Android的callstack库。使用步骤如下：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("在"),a("code",[s._v("Android.bp")]),s._v("的"),a("code",[s._v("shared_libs")]),s._v("中增加如下选项")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"libutilscallstack"')]),s._v(",\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#"libutils",')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#"libcutils",')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("如果是"),a("code",[s._v("Android.mk")]),s._v("则增加如下选项")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("LOCAL_SHARED_LIBRARIES "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" libutilscallstack libcutils libutils \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_1、创建一个-cpp文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、创建一个-cpp文件"}},[s._v("#")]),s._v(" 1、创建一个.cpp文件")]),s._v(" "),a("p",[s._v("dump_stack.cpp")]),s._v(" "),a("div",{staticClass:"language-c++ line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('#include <utils/CallStack.h>\nextern "C"\n{\n    void dumping_callstack(void);\n}\nvoid dumping_callstack(void)\n{\n    android::CallStack stack("[hao22]: start_output_stream");\n}\n\n/*\nvoid dumping_callstack() {\n   android::CallStack stack; \n  //如果这里的函数在android命名空间内，则可以改为 CallStack stack;\n  stack.update();\n  //输出到printf\n  stack.dump(1);\n  //输出到logcat\n  stack.log(TAG);//TAG为日志标签，字符串类型\n  //可以设置第2、3个参数\n  //stack.log("Dumping Stack",ANDROID_LOG_ERROR ,"123 ");\n}\n*/\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("h3",{attrs:{id:"_2、创建一个-h文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、创建一个-h文件"}},[s._v("#")]),s._v(" 2、创建一个.h文件")]),s._v(" "),a("div",{staticClass:"language-c++ line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("#ifndef DUMP_STACK_H\n#define DUMP_STACK_H\nvoid dumping_callstack(void);\n\n#endif\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"_3、添加到android-mk"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、添加到android-mk"}},[s._v("#")]),s._v(" 3、添加到Android.mk")]),s._v(" "),a("p",[s._v("将dump_stack.cpp添加到Android.mk的源文件列表LOCAL_SRC_FILES中，并确保libcutils和libutilscallstack")]),s._v(" "),a("p",[s._v("在LOCAL_SHARED_LIBRARIES列表中")]),s._v(" "),a("p",[a("strong",[s._v("注:P版本的callstack依赖库从libutils \\改到libutilscallstack\\中了")])]),s._v(" "),a("h3",{attrs:{id:"_4、将dump-stack-h头文件添加到目标-c文件中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、将dump-stack-h头文件添加到目标-c文件中"}},[s._v("#")]),s._v(" 4、将dump_stack.h头文件添加到目标.c文件中")]),s._v(" "),a("p",[s._v("如，我想查看audio_hw.c中start_output_stream函数的堆栈调用信息，在audio_hw.c文件中加入")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dump_stack.h"')])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后在start_output_stream函数中添加")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dumping_callstack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])]),s._v(" "),a("h2",{attrs:{id:"java"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#java"}},[s._v("#")]),s._v(" Java")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("添加打印函数")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token import"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("android"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("util"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Log")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Log.d(TAG, Log.getStackTraceString(new Throwable()));//TAG为日志标签，字符串类型")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("d")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TAG"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"打印内容"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Throwable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//TAG为日志标签，字符串类型")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])])]),s._v(" "),a("p",[s._v("https://blog.csdn.net/u012773843/article/details/113055574")]),s._v(" "),a("p",[s._v("本文转自 "),a("a",{attrs:{href:"https://blog.csdn.net/m0_52481422/article/details/109807366",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://blog.csdn.net/m0_52481422/article/details/109807366"),a("OutboundLink")],1),s._v("，如有侵权，请联系删除。")])])}),[],!1,null,null,null);a.default=e.exports}}]);