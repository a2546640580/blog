(window.webpackJsonp=window.webpackJsonp||[]).push([[129],{579:function(t,s,a){"use strict";a.r(s);var e=a(0),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"_1、前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、前言"}},[t._v("#")]),t._v(" 1、前言")]),t._v(" "),s("blockquote",[s("p",[t._v("内核是很庞大的，其中的打印信息也很多，太多的打印信息会拖慢内核的启动速度，也不利于我们查找有用的打印信息。于是内核有了打印优先级的机制，在用printk()打印信息时需要设置优先级，如果不设置优先级也会有一个默认的优先级。只有打印优先级高于控制台输出的优先级时打印信息才会被打印出来，于是我们可以通过修改控制台输出的优先级来控制打印信息的多少，根据想要查看的打印信息的优先级来修改控制台输出的优先级，这样可以确保能打印出我们想要的打印信息，又尽可能少的打印不需要的信息。")])]),t._v(" "),s("h2",{attrs:{id:"_2、console-printk数组"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、console-printk数组"}},[t._v("#")]),t._v(" 2、console_printk数组")]),t._v(" "),s("div",{staticClass:"language-c line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-c"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//内核打印等级")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("define")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token macro-name"}},[t._v("KERN_EMERG")]),t._v("\t\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<0>"')]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* system is unusable\t最高级别，一般只用来打印崩溃信息*/")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("define")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token macro-name"}},[t._v("KERN_ALERT")]),t._v("\t\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<1>"')]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* action must be taken immediately\t 需要立即处理的信息*/")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("define")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token macro-name"}},[t._v("KERN_CRIT")]),t._v("\t\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<2>"')]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* critical conditions\t关键信息：严重的硬件和软件错误\t*/")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("define")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token macro-name"}},[t._v("KERN_ERR")]),t._v("\t\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<3>"')]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* error conditions\t\t 用来显示硬件错误\t*/")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("define")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token macro-name"}},[t._v("KERN_WARNING")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<4>"')]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* warning conditions\t显示不会造成严重错误的警告信息\t\t*/")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("define")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token macro-name"}},[t._v("KERN_NOTICE")]),t._v("\t\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<5>"')]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* normal but significant condition\t 显示需要引起注意的信息*/")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("define")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token macro-name"}},[t._v("KERN_INFO")]),t._v("\t\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<6>"')]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* informational\t　显示一般信息，例如驱动所发现的硬件列表\t\t*/")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("define")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token macro-name"}},[t._v("KERN_DEBUG")]),t._v("\t\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<7>"')]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* debug-level messages\t\t用来显示调试信息\t*/")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* printk's without a loglevel use this.. */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("define")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token macro-name"}},[t._v("DEFAULT_MESSAGE_LOGLEVEL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token expression"}},[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" ")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* KERN_WARNING */")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* We show everything that is MORE important than this.. */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("define")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token macro-name"}},[t._v("MINIMUM_CONSOLE_LOGLEVEL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token expression"}},[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" ")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* Minimum loglevel we let people use */")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("define")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token macro-name"}},[t._v("DEFAULT_CONSOLE_LOGLEVEL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token expression"}},[s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" ")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* anything MORE serious than KERN_DEBUG */")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" console_printk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tDEFAULT_CONSOLE_LOGLEVEL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* console_loglevel */")]),t._v("\n\tDEFAULT_MESSAGE_LOGLEVEL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* default_message_loglevel */")]),t._v("\n\tMINIMUM_CONSOLE_LOGLEVEL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* minimum_console_loglevel */")]),t._v("\n\tDEFAULT_CONSOLE_LOGLEVEL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* default_console_loglevel */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br")])]),s("blockquote",[s("p",[t._v("console_printk数组在kernel/printk.c里定义，其中4个元素是默认的优先级。")]),t._v(" "),s("p",[t._v("(1)"),s("strong",[t._v("DEFAULT_CONSOLE_LOGLEVEL")]),t._v(":控制台日志级别，优先级高于该值的消息将被打印至控制台;")]),t._v(" "),s("p",[t._v("(2)"),s("strong",[t._v("DEFAULT_MESSAGE_LOGLEVEL")]),t._v(":默认的消息日志级别，将用该优先级来打印没有指定优先级的消息。")]),t._v(" "),s("p",[t._v("(3)"),s("strong",[t._v("MINIMUM_CONSOLE_LOGLEVEL")]),t._v(":控制台日志级别可被设置的最小值(最高优先级)。")]),t._v(" "),s("p",[t._v("(4)"),s("strong",[t._v("DEFAULT_CONSOLE_LOGLEVEL")]),t._v(":默认的控制台日志级别，控制台日志级别的缺省值。")])]),t._v(" "),s("h2",{attrs:{id:"_3、源代码修改控制台输出级别"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、源代码修改控制台输出级别"}},[t._v("#")]),t._v(" 3、源代码修改控制台输出级别")]),t._v(" "),s("blockquote",[s("p",[t._v("将DEFAULT_CONSOLE_LOGLEVEL修改为你想要的等级，一般设置成你想要打印出的消息的等级，这样可以确保打印出你需要的信息，又尽可能少的打印无用信息。")])]),t._v(" "),s("h2",{attrs:{id:"_4、动态修改控制台输出等级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、动态修改控制台输出等级"}},[t._v("#")]),t._v(" 4、动态修改控制台输出等级")]),t._v(" "),s("h3",{attrs:{id:"_4-1、查看当前的控制台输出等级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1、查看当前的控制台输出等级"}},[t._v("#")]),t._v(" 4.1、查看当前的控制台输出等级")]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /proc/sys/kernel/printk \n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("                            "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("                    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("                  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("\n当前的日志级别\t未明确指定日志级别的默认消息级别\t最小允许的日志级别\t引导时的默认日志级别\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("h3",{attrs:{id:"_4-2、修改当前的输出等级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2、修改当前的输出等级"}},[t._v("#")]),t._v(" 4.2、修改当前的输出等级")]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" proc/sys/kernel/printk\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("blockquote",[s("p",[t._v("上面就是通过echo命令往printk文件写数据，将当前的日志级别改为4；")])]),t._v(" "),s("h2",{attrs:{id:"_5、频繁打印带来的问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5、频繁打印带来的问题"}},[t._v("#")]),t._v(" 5、频繁打印带来的问题")]),t._v(" "),s("blockquote",[s("p",[t._v("(1)慢速控制台设备输出过多的消息导致系统变慢，因为控制台会频繁的占用CPU；")]),t._v(" "),s("p",[t._v("(2)当程序出错后会不停的打印出错信息。虽然我们设置的输出等级，但是一般都会运行printk输出出错打印，程序正常运行时不会有打印，但是当程序出错后，程序有可能会不停的打印出错信息，这样也会造成输出巨量消息；")])]),t._v(" "),s("h2",{attrs:{id:"_6、限制频繁打印信息的措施"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6、限制频繁打印信息的措施"}},[t._v("#")]),t._v(" 6、限制频繁打印信息的措施")]),t._v(" "),s("h3",{attrs:{id:"_6-1、printk-ratelimit-函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-1、printk-ratelimit-函数"}},[t._v("#")]),t._v(" 6.1、printk_ratelimit()函数")]),t._v(" "),s("div",{staticClass:"language-c line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-c"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printk_ratelimit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\t\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printk")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("KERN_NOTICE "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"The printer is still on fire\\n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("blockquote",[s("p",[t._v("printk_ratelimit()通过跟踪发送到控制台的消息数量，如果输出的速度超过一个阈值则返回零，从而避免发送重复消息；")])]),t._v(" "),s("h3",{attrs:{id:"_6-2、printk-ratelimit和printk-ratelimit-burst"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2、printk-ratelimit和printk-ratelimit-burst"}},[t._v("#")]),t._v(" 6.2、printk_ratelimit和printk_ratelimit_burst")]),t._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("~ "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat /proc/sys/kernel/printk_ratelimit")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n~ "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ")]),t._v("\n~ "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ")]),t._v("\n~ "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat /proc/sys/kernel/printk_ratelimit_burst ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("blockquote",[s("p",[t._v("(1)printk_ratelimit文件：在重新打开消息之前应该等待的秒数；"),s("br"),t._v("\n(2)printk_ratelimit_burst文件：在进行速度限制之前可以接受的消息数；")])]),t._v(" "),s("h2",{attrs:{id:"printk-和printf-的比较"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#printk-和printf-的比较"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://blog.csdn.net/weixin_42031299/article/details/121448380",target:"_blank",rel:"noopener noreferrer"}},[t._v("printk()和printf()的比较"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("但是在Android中，直接使用printf是无法将信息输出到串口中显示的（除非直接通过串口运行可执行程序）。为了继续使用printf，可以使用重定向的方式，将printf的输出从STDOUT转到文件中，同时方便串口输入命令调试，也不影响日志的记录。")]),t._v(" "),s("p",[t._v('freopen("/data/flash/stdout.txt","w",stdout);')]),t._v(" "),s("p",[t._v("仅需在使用printf前调用上面的函数即可，同时在使用printf后为了保证输出及时写入文件，需要使用fflush函数。当然，也有说可以调用 setvbuf(stdout,NULL,_IONBF,0)来完成缓冲区的设置，但是不一定有效。")]),t._v(" "),s("p",[t._v("本文转自 "),s("a",{attrs:{href:"https://blog.csdn.net/weixin_42031299/article/details/121734876",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://blog.csdn.net/weixin_42031299/article/details/121734876"),s("OutboundLink")],1),t._v("，如有侵权，请联系删除。")])])}),[],!1,null,null,null);s.default=n.exports}}]);