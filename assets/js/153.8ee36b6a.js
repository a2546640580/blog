(window.webpackJsonp=window.webpackJsonp||[]).push([[153],{608:function(s,n,a){"use strict";a.r(n);var e=a(0),t=Object(e.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"一、android-mk文件的作用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、android-mk文件的作用"}},[s._v("#")]),s._v(" 一、Android.mk文件的作用")]),s._v(" "),n("p",[s._v("Android.mk是Android工程管理文件，类似于编译文件的说明书，用来向编译系统描述源代码，并将源文件分组为模块（包括静态库、共享库、独立可执行文件）。Android.mk会被编译系统解析一次或多次，可以在每一个Android.mk文件中定义一个或多个模块，也可以多个模块使用同一个 .mk 文件。")]),s._v(" "),n("h2",{attrs:{id:"二、最基础的android-mk构成"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、最基础的android-mk构成"}},[s._v("#")]),s._v(" 二、最基础的Android.mk构成")]),s._v(" "),n("p",[n("strong",[s._v("Android.mk文件必须先定义LOCAL_PATH变量")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("##源文件在开发树中的位置, 表示当前模块位置的变量\n#宏函数my-dir 返回当前文件所在的路径， \nLOCAL_PATH := $(call my-dir)  \n\n#CLEAR_VAR变量指向一个特殊的Makefile\n#清除了LOCAL_PATH变量之外的 LOCAL_XXX 变量,如：LOCAL_SRC_FILES,LOCAL_MODULE,LOCAL_STATIC_LIBRARIES\ninclude $(CLEAR_VARS)  \n\n# 需要编译的文件，可以是单个源文件，也可以是一个文件夹\nLOCAL_SRC_FILES := hello-jni.c\n\n#构建的模块的名称，名称必须唯一，不能有任何空格，生成最终共享库文件时会添加其前缀lib及后缀.so,如libhello-jni.so\nLOCAL_MODULE    := hello-jni    \n\n#通过include $(BUILD_SHARED_LIBRARY)编译工具，将BUILD_SHARED_LIBRARY变量指向一个makefile脚本，该脚本根据最近include以来在LOCAL_XXX变量中定义的所有信息。此脚本确定要构建的内容以及构建方式。\ninclude $(BUILD_SHARED_LIBRARY)  \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("h2",{attrs:{id:"三、模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、模块"}},[s._v("#")]),s._v(" 三、模块")]),s._v(" "),n("p",[n("strong",[s._v("oid.mk中我们把以"),n("code",[s._v("include $(CLEAR_VARS)")]),s._v("标记开头，到"),n("code",[s._v("include $(BUILD_XXX)")]),s._v("标记结束，这中间描述的所有行为，称为一个模块。")])]),s._v(" "),n("p",[s._v("例如：下列mk中包含了，两个模块。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_PATH:= $(call my-dir)\ninclude $(CLEAR_VARS)\n\nLOCAL_SRC_FILES := \\\n        $(call all-logtags-files-under, src)\n\nLOCAL_MODULE := settings-logtags\n# 构建一个 java 类库\ninclude $(BUILD_STATIC_JAVA_LIBRARY)\n-------------------------------------------------------\ninclude $(CLEAR_VARS)\n\nLOCAL_PACKAGE_NAME := Settings\n#省略其它描述...\nLOCAL_USE_AAPT2 := true\n\nLOCAL_SRC_FILES := $(call all-java-files-under, src)\n\nLOCAL_STATIC_ANDROID_LIBRARIES := \\\n    androidx-constraintlayout_constraintlayout \\\n#省略其它描述...\ninclude frameworks/base/packages/SettingsLib/common.mk\ninclude frameworks/base/packages/SettingsLib/search/common.mk\n# 构建一个apk文件\ninclude $(BUILD_PACKAGE)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("h2",{attrs:{id:"四、include变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四、include变量"}},[s._v("#")]),s._v(" 四、include变量")]),s._v(" "),n("p",[n("strong",[s._v("CLEAR_VARS")])]),s._v(" "),n("p",[n("strong",[s._v("用于取消位于"),n("code",[s._v("include $(CLEAR_VARS)")]),s._v("之前定义的所有的LOCAL_XXX变量中定义的值，但是LOCAL_PATH中定义的值不会被取消。在描述新的模块前，需要用include包含此变量。")])]),s._v(" "),n("ul",[n("li",[n("code",[s._v("include $(BUILD_SHARED_LIBRARY)")]),s._v(" 编译成动态库（共享库）")]),s._v(" "),n("li",[n("code",[s._v("include $(BUILD_STATIC_LIBRARIES)")]),s._v("编译成native静态库。")]),s._v(" "),n("li",[n("code",[s._v("include $(BUILD_JAVA_LIBRARY)")]),s._v("编译成共享JAVA库，是在静态库的基础上进一步打包成的.dex文件，众所周知，dex是在android系统上所使用的文件格式。")])]),s._v(" "),n("p",[n("a",{attrs:{"data-fancybox":"",title:"img",href:"https://img-blog.csdnimg.cn/img_convert/c4642de59aa78d4d4a9dc18df070315a.png"}},[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/shug666/image/images/c4642de59aa78d4d4a9dc18df070315a.png",alt:"img"}})])]),s._v(" "),n("ul",[n("li",[n("code",[s._v("include $(BUILD_STATIC_JAVA_LIBRARY)")]),s._v("编译成静态java库，该类库中代码会以class文件的形式存在，它在任何一个JAVA虚拟机上都可以运行")]),s._v(" "),n("li",[n("code",[s._v("include $(BUILD_MULTI_PREBUILT)")]),s._v("用于编译预制库，这些库一般可以指定在lib文件夹下。")]),s._v(" "),n("li",[n("code",[s._v("include $(BUILD_PREBUILT)")]),s._v("   这种方式把文件当成编译项目。")]),s._v(" "),n("li",[n("code",[s._v("include $(BUILD_PACKAGE)")]),s._v("用于编译Android 应用程序安装包。")]),s._v(" "),n("li",[n("code",[s._v("include $(BUILD_EXECUTABLE)")]),s._v(" 编译成可执行程序")])]),s._v(" "),n("h2",{attrs:{id:"五、模块描述变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#五、模块描述变量"}},[s._v("#")]),s._v(" 五、模块描述变量")]),s._v(" "),n("p",[n("strong",[s._v("LOCAL_PATH")])]),s._v(" "),n("p",[s._v("此变量用于指定当前文件的路径。必须在 "),n("code",[s._v("Android.mk")]),s._v(" 文件开头定义此变量。以下示例演示了如何定义此变量：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_PATH := $(call my-dir)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("code",[s._v("CLEAR_VARS")]),s._v(" 所指向的脚本不会清除此变量。因此，即使 "),n("code",[s._v("Android.mk")]),s._v(" 文件描述了多个模块，也只需定义此变量一次。")]),s._v(" "),n("p",[n("strong",[s._v("LOCAL_MODULE")])]),s._v(" "),n("p",[s._v("此变量用于设定模块的名称。指定的名称在所有模块名称中必须唯一，并且不得包含任何空格。必须先定义该名称，然后才能添加其它的脚本（"),n("code",[s._v("CLEAR_VARS")]),s._v(" 的脚本除外）。如下定义在配合"),n("code",[s._v("include $(BUILD_STATIC_JAVA_LIBRARY)")]),s._v("使用时会编译时生成一个"),n("code",[s._v("libsettings-logtags")]),s._v("的类库，lib是编译时系统自动加上的。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_MODULE := settings-logtags\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("strong",[s._v("LOCAL_MODULE_FILENAME")])]),s._v(" "),n("p",[s._v("此变量能够替换构建系统为其生成的文件默认使用的名称。例如，如果 "),n("code",[s._v("LOCAL_MODULE")]),s._v(" 的名称为 "),n("code",[s._v("settings-logtags")]),s._v("，你可以强制系统将其生成的文件命名为 "),n("code",[s._v("settingslib")]),s._v("。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_MODULE := settings-logtags\nLOCAL_MODULE_FILENAME := settingslib\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[n("strong",[s._v("LOCAL_SRC_FILES")])]),s._v(" "),n("p",[s._v("此变量包含构建系统生成模块时所用的源文件列表。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_SRC_FILES := \\\n        $(call all-logtags-files-under, src)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[n("strong",[s._v("LOCAL_PACKAGE_NAME")])]),s._v(" "),n("p",[s._v("此变量用于指定编译后生成的Android APK的名字。例如，如下方式，会生成一个Settings.apk的文件。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_PACKAGE_NAME := Settings\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("strong",[s._v("LOCAL_CERTIFICATE")])]),s._v(" "),n("p",[s._v("此变量用于指定APK的签名方式。如果不指定，默认使用testkey签名。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_CERTIFICATE := platform\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("strong",[s._v("Android中共有四中签名方式：")])]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("testkey：普通APK，默认使用该签名。")])]),s._v(" "),n("li",[n("strong",[s._v("platform：该APK完成一些系统的核心功能。经过对系统中存在的文件夹的访问测试，这种方式编译出来的APK所在进程的UID为system。")])]),s._v(" "),n("li",[n("strong",[s._v("shared：该APK需要和home/contacts进程共享数据。")])]),s._v(" "),n("li",[n("strong",[s._v("media：该APK是media/download系统中的一环。")])])]),s._v(" "),n("p",[n("strong",[s._v("LOCAL_PRODUCT_MODULE")])]),s._v(" "),n("p",[s._v("为true表示将此apk安装到priv-app目录下。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_PRODUCT_MODULE := true\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("strong",[s._v("LOCAL_SDK_VERSION")])]),s._v(" "),n("p",[s._v("标记SDK 的version 状态。取值范围有四个"),n("code",[s._v("current")]),s._v(" "),n("code",[s._v("system_current")]),s._v(" "),n("code",[s._v("test_current")]),s._v(" "),n("code",[s._v("core_current")]),s._v(" 。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_SDK_VERSION := current\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("strong",[s._v("LOCAL_PRIVATE_PLATFORM_APIS")])]),s._v(" "),n("p",[s._v("设置后，会使用sdk的hide的api來编译。编译的APK中使用了系统级API，必须设定该值。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_PRIVATE_PLATFORM_APIS := true\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("strong",[s._v("LOCAL_USE_AAPT2")])]),s._v(" "),n("p",[s._v("此值用于设定是否开启AAPT2打包APK，AAPT是Android Asset Packaging Tool的缩写，AAPT2在AAPT的基础做了优化。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_USE_AAPT2 := true\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("strong",[s._v("LOCAL_STATIC_ANDROID_LIBRARIES")])]),s._v(" "),n("p",[s._v("此值用于设定依赖的静态Android库")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_STATIC_ANDROID_LIBRARIES := \\\n    androidx-constraintlayout_constraintlayout \\\n    androidx.slice_slice-builders \\\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[n("strong",[s._v("LOCAL_JAVA_LIBRARIES")])]),s._v(" "),n("p",[s._v("此值用于设定依赖的共享java类库。"),n("code",[s._v("LOCAL_JAVA_LIBRARIES")]),s._v("引用的外部Java库在编译时可以找到相关的东西，但并不打包到本模块，在runtime时需要从别的地方查找，这个别的地方就是在编译时将引用的外部Java库的模块名添加到"),n("code",[s._v("PRODUCT_BOOT_JARS")]),s._v("。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_JAVA_LIBRARIES := \\\n    telephony-common \\\n    ims-common\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[n("strong",[s._v("LOCAL_STATIC_JAVA_LIBRARIES")])]),s._v(" "),n("p",[s._v("此值用于设定依赖的静态java类库。"),n("code",[s._v("LOCAL_STATIC_JAVA_LIBRARIES")]),s._v("会把引用的外部Java库直接编译打包到本模块中，在runtime时可以直接从本模块中找到相关的jar。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_STATIC_JAVA_LIBRARIES := \\\n    androidx-constraintlayout_constraintlayout-solver \\\n    androidx.lifecycle_lifecycle-runtime \\\n    androidx.lifecycle_lifecycle-extensions \\\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("strong",[s._v("LOCAL_PROGUARD_FLAG_FILES")])]),s._v(" "),n("p",[s._v("此值用于设定混淆的标志。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_PROGUARD_FLAG_FILES := proguard.flags\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("Android.mk中以LOCAL_XXX开头的描述变量非常多，这里只列举了一些常用的变量。")]),s._v(" "),n("h2",{attrs:{id:"六、函数宏"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#六、函数宏"}},[s._v("#")]),s._v(" 六、函数宏")]),s._v(" "),n("p",[s._v("Android系统中提供了大量的宏函数，使用 "),n("code",[s._v("$(call <function>)")]),s._v(" 可以对其进行求值，返回文本信息。")]),s._v(" "),n("p",[n("strong",[s._v("my-dir")])]),s._v(" "),n("p",[s._v("这个宏返回最后包括的 makefile 的路径，"),n("strong",[s._v("通常是当前 "),n("code",[s._v("Android.mk")]),s._v(" 的目录")]),s._v("。"),n("code",[s._v("my-dir")]),s._v(" 可用于在 "),n("code",[s._v("Android.mk")]),s._v(" 文件开头定义 "),n("code",[s._v("LOCAL_PATH")]),s._v("。例如：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_PATH := $(call my-dir)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("由于 GNU Make 的工作方式，这个宏实际返回的是构建系统解析构建脚本时包含的最后一个 makefile 的路径。因此，包括其他文件后就不应调用 "),n("code",[s._v("my-dir")]),s._v("。")]),s._v(" "),n("p",[s._v("例如：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_PATH := $(call my-dir)\n# ... declare one module\ninclude $(LOCAL_PATH)/foo/`Android.mk`\nLOCAL_PATH := $(call my-dir)\n# ... declare another module\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("这里的问题在于，对 "),n("code",[s._v("my-dir")]),s._v(" 的第二次调用将 "),n("code",[s._v("LOCAL_PATH")]),s._v(" 定义为 "),n("code",[s._v("$PATH/foo")]),s._v("，而不是 "),n("code",[s._v("$PATH")]),s._v("，因为这是其最近的 include 所指向的位置。在 "),n("code",[s._v("Android.mk")]),s._v(" 文件中的任何其他内容后指定额外的 include 可避免此问题。例如：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_PATH := $(call my-dir)\n# ... declare one module\nLOCAL_PATH := $(call my-dir)\n# ... declare another module\n# extra includes at the end of the Android.mk file\ninclude $(LOCAL_PATH)/foo/Android.mk\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("如果以这种方式构造文件不可行，请将第一个 "),n("code",[s._v("my-dir")]),s._v(" 调用的值保存到另一个变量中。例如：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("MY_LOCAL_PATH := $(call my-dir)\nLOCAL_PATH := $(MY_LOCAL_PATH)\n# ... declare one module\ninclude $(LOCAL_PATH)/foo/`Android.mk`\nLOCAL_PATH := $(MY_LOCAL_PATH)#\n ... declare another module\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[n("strong",[s._v("几个常用的获取源文件的方法：")])]),s._v(" "),n("ul",[n("li",[n("code",[s._v("$(call all-java-files-under, src)")]),s._v(" 获取指定目录下的所有 Java 文件。")]),s._v(" "),n("li",[n("code",[s._v("$(call all-c-files-under, src)")]),s._v("获取指定目录下的所有 C 语言文件。")]),s._v(" "),n("li",[n("code",[s._v("$(call all-Iaidl-files-under, src)")]),s._v("获取指定目录下的所有 AIDL 文件。")]),s._v(" "),n("li",[n("code",[s._v("$(call all-makefiles-under, folder)")]),s._v("获取指定目录下的所有 Make 文件。")])]),s._v(" "),n("h2",{attrs:{id:"七、引入第三方库和androidx库-重要"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#七、引入第三方库和androidx库-重要"}},[s._v("#")]),s._v(" 七、引入第三方库和Androidx库（重要）")]),s._v(" "),n("p",[n("strong",[s._v("引入lib文件夹下的第三方库")])]),s._v(" "),n("p",[s._v("在实际开发中，我们经常需要在app中引入第三方的jar或aar，在Android.mk中，可以按照如下的方式描述：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_PATH:= $(call my-dir)\ninclude $(CLEAR_VARS)\n# ...\nLOCAL_STATIC_JAVA_LIBRARIES := \\\n    contextualcards # 给引入的jar或aar 起一个别名\n# ...\ninclude $(BUILD_PACKAGE)\n# ====  预制类库 ========================\ninclude $(CLEAR_VARS)\nLOCAL_PREBUILT_STATIC_JAVA_LIBRARIES := \\\n    contextualcards:libs/contextualcards.aar # 指定contextualcards的实际路径\ninclude $(BUILD_MULTI_PREBUILT)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[n("strong",[s._v("引入AndroidX库")])]),s._v(" "),n("p",[s._v("开发过程如果想要引入AndroidX的类库可以参考下面的方式编写。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_PATH:= $(call my-dir)\ninclude $(CLEAR_VARS)\n# ...\nLOCAL_STATIC_ANDROID_LIBRARIES := \\\n    androidx-constraintlayout_constraintlayout \\\n    androidx.appcompat_appcompat \\\n\nLOCAL_STATIC_JAVA_LIBRARIES := \\\n    androidx-constraintlayout_constraintlayout-solver \\\n# ...\ninclude $(BUILD_PAC\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("上面的mk中主要是引入了"),n("code",[s._v("AndroidX")]),s._v("下的"),n("code",[s._v("appcompat")]),s._v("和"),n("code",[s._v("constraintlayout")]),s._v("库。其中"),n("code",[s._v("constraintlayout")]),s._v("不仅需要在"),n("code",[s._v("LOCAL_STATIC_ANDROID_LIBRARIES")]),s._v("引入"),n("code",[s._v("androidx-constraintlayout_constraintlayout")]),s._v("，还需要在"),n("code",[s._v("LOCAL_STATIC_JAVA_LIBRARIES")]),s._v("中引入"),n("code",[s._v("androidx-constraintlayout_constraintlayout-solver")])]),s._v(" "),n("blockquote",[n("p",[s._v("在控制台使用指令 "),n("code",[s._v('find prebuilts/sdk/ -name Android.bp|xargs grep "name.*粗略的名字"')]),s._v("查询类库的引入方式。使用之前需要先 # source build/envsetup.sh # lunch，不然无法执行find指令。\n使用示例："),n("code",[s._v('find prebuilts/sdk/ -name Android.bp|xargs grep "name.*``constraintlayout``"')])])]),s._v(" "),n("h2",{attrs:{id:"八、参考『系统设置』的android-mk"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#八、参考『系统设置』的android-mk"}},[s._v("#")]),s._v(" 八、参考『系统设置』的Android.mk")]),s._v(" "),n("p",[s._v("Android.mk的编写，我们很多时候可以参考系统中已有的Android.mk，例如下面给的就是Android R中系统设置的Android.mk。")]),s._v(" "),n("blockquote",[n("p",[s._v("该mk的位于 packages/apps/Settings 下")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_PATH:= $(call my-dir)\ninclude $(CLEAR_VARS)\n\nLOCAL_SRC_FILES := \\\n        $(call all-logtags-files-under, src)\n\nLOCAL_MODULE := settings-logtags\n# 构建一个 libsettings-logtags的静态java类库\ninclude $(BUILD_STATIC_JAVA_LIBRARY)\n\n# 构建一个Settings.apk\ninclude $(CLEAR_VARS)\n\nLOCAL_PACKAGE_NAME := Settings\nLOCAL_PRIVATE_PLATFORM_APIS := true\nLOCAL_CERTIFICATE := platform\nLOCAL_PRODUCT_MODULE := true\nLOCAL_PRIVILEGED_MODULE := true\nLOCAL_REQUIRED_MODULES := privapp_whitelist_com.android.settings\nLOCAL_MODULE_TAGS := optional\nLOCAL_USE_AAPT2 := true\n\nLOCAL_SRC_FILES := $(call all-java-files-under, src)\n\nLOCAL_STATIC_ANDROID_LIBRARIES := \\\n    androidx-constraintlayout_constraintlayout \\\n    androidx.slice_slice-builders \\\n    androidx.slice_slice-core \\\n    androidx.slice_slice-view \\\n    androidx.core_core \\\n    androidx.appcompat_appcompat \\\n    androidx.cardview_cardview \\\n    androidx.preference_preference \\\n    androidx.recyclerview_recyclerview \\\n    com.google.android.material_material \\\n    setupcompat \\\n    setupdesign\n\nLOCAL_JAVA_LIBRARIES := \\\n    telephony-common \\\n    ims-common\n\nLOCAL_STATIC_JAVA_LIBRARIES := \\\n    androidx-constraintlayout_constraintlayout-solver \\\n    androidx.lifecycle_lifecycle-runtime \\\n    androidx.lifecycle_lifecycle-extensions \\\n    guava \\\n    jsr305 \\\n    settings-contextual-card-protos-lite \\\n    settings-log-bridge-protos-lite \\\n    contextualcards \\\n    settings-logtags \\\n    zxing-core-1.7\n\nLOCAL_PROGUARD_FLAG_FILES := proguard.flags\n\nifneq ($(INCREMENTAL_BUILDS),)\n    LOCAL_PROGUARD_ENABLED := disabled\n    LOCAL_JACK_ENABLED := incremental\n    LOCAL_JACK_FLAGS := --multi-dex native\nendif\n\ninclude frameworks/base/packages/SettingsLib/common.mk\ninclude frameworks/base/packages/SettingsLib/search/common.mk\n\ninclude $(BUILD_PACKAGE)\n\n# ====  prebuilt library  ========================\ninclude $(CLEAR_VARS)\n\nLOCAL_PREBUILT_STATIC_JAVA_LIBRARIES := \\\n    contextualcards:libs/contextualcards.aar\ninclude $(BUILD_MULTI_PREBUILT)\n\n# Use the following include to make our test apk.\nifeq (,$(ONE_SHOT_MAKEFILE))\ninclude $(call all-makefiles-under,$(LOCAL_PATH))\nendif\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br")])]),n("h2",{attrs:{id:"九、android-mk-与-makefile文件的区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#九、android-mk-与-makefile文件的区别"}},[s._v("#")]),s._v(" 九、android.mk 与 makefile文件的区别")]),s._v(" "),n("p",[s._v("android.mk与makefile是一样的功能，只不过是一种特殊的“makefile”文件, 它是经过了android编译系统处理的，android.mk的格式就变得非常简单，且与普通的makefile文件书写格式不一样了，但这有利于为Android增加一个新的Component。")]),s._v(" "),n("p",[s._v("但android.mk文件最终还是要被android编译系统层层解析，转化为make命令能够读懂的格式，从而调用gcc编译器进行编译;")]),s._v(" "),n("h2",{attrs:{id:"十、android-mk的使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#十、android-mk的使用"}},[s._v("#")]),s._v(" 十、Android.mk的使用")]),s._v(" "),n("p",[n("em",[n("strong",[s._v("*编译apk*")])]),s._v("  重点apk中的签名 和 apis")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_PATH:=$(call my-dir)   #返回当前路径\n\ninclude $(CLEAR_VARS)\t\t  #清除除了LOCAL_PATH的，所有LACAL_开头的系统变量\nLOCAL_SRC_FILE:=       #指定编译的文件 \nCAL_PRIVATE_PLATFORM_APIS := true\nLOCAL_CERTIFICATE := platform\t\t\nLOCAL_PACKAGE_NAME=ABC\t\t\t\t#指定唯一的包名\ninclude $(BUILD_PACKAGE)\t\t\t\t\t#编译apk或者其他指定的文件\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[n("em",[n("strong",[s._v("*编译静态库*")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_PATH := $(call my-dir) \n\ninclude $(CLEAR_VARS)  \nLOCAL_MODULE = libhellos  \nLOCAL_CFLAGS = $(L_CFLAGS)  \nLOCAL_SRC_FILES = hellos.c  \nLOCAL_C_INCLUDES = $(INCLUDES)  \nLOCAL_SHARED_LIBRARIES := libcutils  \nLOCAL_COPY_HEADERS_TO := libhellos  \nLOCAL_COPY_HEADERS := hellos.h  \ninclude $(BUILD_STATIC_LIBRARY)  \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[n("em",[n("strong",[s._v("*编译动态库*")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_PATH := $(call my-dir)  \n\ninclude $(CLEAR_VARS)  \nLOCAL_MODULE = libhellod  \nLOCAL_SRC_FILES = hellod.c  \nLOCAL_C_INCLUDES = $(INCLUDES)  \nLOCAL_SHARED_LIBRARIES := libcutils  \nLOCAL_SHARED_LIBRARIES := libcutils  #链接时需要的外部库\nLOCAL_LDLIBS += -ldl  \nLOCAL_CFLAGS := $(L_CFLAGS)  \t\t#需要包含的头文件目录\nLOCAL_COPY_HEADERS_TO := libhellod  \nLOCAL_COPY_HEADERS := hellod.h  \ninclude $(BUILD_SHARED_LIBRARY)  \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[n("em",[n("strong",[s._v("*使用静态库*")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_PATH := $(call my-dir)  \n\ninclude $(CLEAR_VARS)  \nLOCAL_MODULE := hellos  \nLOCAL_STATIC_LIBRARIES := libhellos  \nLOCAL_SHARED_LIBRARIES :=  \nLOCAL_LDLIBS += -ldl  \nLOCAL_CFLAGS := $(L_CFLAGS)  \nLOCAL_SRC_FILES := mains.c  \nLOCAL_C_INCLUDES := $(INCLUDES)  \ninclude $(BUILD_EXECUTABLE)  \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[n("em",[n("strong",[s._v("*使用动态库*")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_PATH := $(call my-dir)\n\ninclude $(CLEAR_VARS)  \nLOCAL_MODULE := hellod  \nLOCAL_MODULE_TAGS := debug  \nLOCAL_SHARED_LIBRARIES := libc libcutils libhellod  \nLOCAL_LDLIBS += -ldl  \nLOCAL_CFLAGS := $(L_CFLAGS)  \nLOCAL_SRC_FILES := maind.c  \nLOCAL_C_INCLUDES := $(INCLUDES)  \ninclude $(BUILD_EXECUTABLE)  \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[n("em",[n("strong",[s._v("*拷贝文件到指定目录*")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_PATH := $(call my-dir)\n\ninclude $(CLEAR_VARS)\nLOCAL_MODULE := bt_vendor.conf\nLOCAL_MODULE_CLASS := ETC\nLOCAL_MODULE_PATH := $(TARGET_OUT)/etc/bluetooth\nLOCAL_MODULE_TAGS := eng\nLOCAL_SRC_FILES := $(LOCAL_MODULE)\ninclude $(BUILD_PREBUILT)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[n("em",[n("strong",[s._v("*拷贝动态库到指定目录*")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_PATH := $(call my-dir)\n\ninclude $(CLEAR_VARS)\n\\#the data or lib you want to copy\nLOCAL_MODULE := libxxx.so\nLOCAL_MODULE_CLASS := SHARED_LIBRARIES\nLOCAL_MODULE_PATH := $(ANDROID_OUT_SHARED_LIBRARIES)\nLOCAL_SRC_FILES := lib/$(LOCAL_MODULE )\nOVERRIDE_BUILD_MODULE_PATH := \t$(TARGET_OUT_INTERMEDIATE_LIBRARIES)\ninclude $(BUILD_PREBUILT)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_MODULE_TAGS :=optional\t\n\nuser: 指该模块只在user版本下才编译\neng: 指该模块只在eng版本下才编译\ntests: 指该模块只在tests版本下才编译\noptional:指该模块在所有版本下都编译\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("以上是Android.mk的基本组成，当然除了apk的编译，其他的并不是最基本的，目前我只用到了apk和动态库和静态库的编译，一些系统变量和函数，要根据你实际的使用来选择，如果以后遇到不懂得函数和系统变量可以自行查阅文档。")]),s._v(" "),n("h2",{attrs:{id:"项目中怎么编译"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#项目中怎么编译"}},[s._v("#")]),s._v(" 项目中怎么编译")]),s._v(" "),n("p",[s._v("在之前的JNI的使用中，Android.mk 文件位于项目 jni/ 目录的子目录中，可以通过ndk-build 脚本进行编译。")]),s._v(" "),n("p",[s._v("在我们的项目管理里面，需要进入kernel/android/R(对应版本11)：")]),s._v(" "),n("p",[n("strong",[s._v("1、执行source build/envsetup.sh 脚本")])]),s._v(" "),n("p",[n("strong",[s._v("2、lunch搭建环境，定义Product和编译过程中用到的全局变量。")])]),s._v(" "),n("p",[n("strong",[s._v("3、使用mm或者mmm + 文件路径（vendor/toptech/apps/JNITest/） 编译")])]),s._v(" "),n("p",[n("strong",[s._v("4、生成的apk文件在out\\target\\product\\Ateko\\system\\app\\SHUGAN（对应LOCAL_PACKAGE_NAME）目录下")])]),s._v(" "),n("p",[n("strong",[s._v("5、编译成功后的一些文件（如Androidfest文件）在out\\target\\common\\obj\\APPS\\SHUGAN_intermediates目录下")])]),s._v(" "),n("p",[n("em",[n("strong",[s._v("*跑完之后生成apk文件，拷到U盘上就可以在TV上安装了。*")])])]),s._v(" "),n("p",[n("a",{attrs:{"data-fancybox":"",title:"image-20220802160511441",href:"https://s2.loli.net/2022/08/17/8wvh7qjVbzkYLNs.png"}},[n("img",{attrs:{src:"https://s2.loli.net/2022/08/17/8wvh7qjVbzkYLNs.png",alt:"image-20220802160511441"}})])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_PATH，          当前路径，必须定义。\nLOCAL_PACKAGE_NAME，  必须定义，package的名字，这个名字在脚本中将标识app或package。\nLOCAL_MODULE_SUFFIX， 不用定义，module的后缀，=.apk。\nLOCAL_MODULE，        不用定义，=$(LOCAL_PACKAGE_NAME)。\nLOCAL_JAVA_RESOURCE_DIRS，     不用定义。\nLOCAL_JAVA_RESOURCE_FILES，    不用定义。\nLOCAL_MODULE_CLASS，  不用定义。\nLOCAL_MODULE_TAGS，   可选定义。默认optional。取值范围user debug eng tests optional samples shell_ash shell_mksh。\nLOCAL_ASSET_DIR，     可选定义，推荐不定义。默认$(LOCAL_PATH)/assets\nLOCAL_RESOURCE_DIR，  可选定义，推荐不定义。默认product package和device package相应的res路径和$(LOCAL_PATH)/res。\nLOCAL_PROGUARD_ENABLED，       可选定义，默认为full，如果是user或userdebug。取值full, disabled, custom。\nLOCAL_MANIFEST_FILE，        不用定义，=$(LOCAL_PATH)/AndroidManifest.xml。\nLOCAL_EXPORT_PACKAGE_RESOURCES，    可选定义，默认null。如果允许app的资源被其它模块使用，则设置true。\nLOCAL_CERTIFICATE，   可选定义，默认为testkey。最终\nprivate_key := $(LOCAL_CERTIFICATE).pk8\ncertificate := $(LOCAL_CERTIFICATE).x509.pem\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("p",[n("a",{attrs:{href:"https://www.jianshu.com/p/8aabfbbb18c3",target:"_blank",rel:"noopener noreferrer"}},[s._v("Android.mk编译生成apk模板"),n("OutboundLink")],1)]),s._v(" "),n("p",[n("a",{attrs:{href:"https://blog.csdn.net/zcjxaiofeizhu/article/details/124402351",target:"_blank",rel:"noopener noreferrer"}},[s._v("Android源码目录"),n("OutboundLink")],1)]),s._v(" "),n("p",[n("strong",[s._v("如果material报错则需要去掉该主题风格")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("LOCAL_PATH:= $(call my-dir)\ninclude $(CLEAR_VARS)\n\t\nLOCAL_STATIC_ANDROID_LIBRARIES := \\\n\tcom.google.android.material_material \\\n\tandroidx-constraintlayout_constraintlayout \\\n\tandroidx.appcompat_appcompat \\\n#\tandroid-support-v7-appcompat \\\n\t\n\t\nLOCAL_STATIC_JAVA_LIBRARIES := \\\n    androidx-constraintlayout_constraintlayout-solver \\\n\t\nLOCAL_MODULE_TAGS := optional\nLOCAL_PACKAGE_NAME := SHUGAN\nLOCAL_SRC_FILES := $(call all-java-files-under, src)\n#LOCAL_RESOURCE_DIR := $(LOCAL_PATH)/res\n#LOCAL_MANIFEST_FILE := $(LOCAL_PATH)/AndroidManifest.xml\nLOCAL_PRIVATE_PLATFORM_APIS := true\nLOCAL_CERTIFICATE := platform\n\ninclude $(BUILD_PACKAGE)\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);